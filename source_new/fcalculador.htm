<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Untitled</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="SynEdit HTML exporter" />
<style type="text/css">
<!--
body { color: #000000; background-color: #FFFFFF; }
.pas1-assembler { color: #FF0080; }
.pas1-character { color: #000000; }
.pas1-comment { color: #C0C0C0; }
.pas1-float { color: #000080; }
.pas1-hexadecimal { color: #000080; }
.pas1-identifier { color: #FF0000; }
.pas1-number { color: #0000FF; }
.pas1-preprocessor { color: #000000; }
.pas1-reservedword { color: #0000FF; }
.pas1-space { color: #008080; font-style: italic; }
.pas1-string { color: #FFFF00; }
.pas1-symbol { color: #000000; }
-->
</style>
</head>
<body>
<pre>
<code><span style="font: 10pt Courier New;"><span class="pas1-comment">{
Projeto FolhaLivre - Folha de Pagamento Livre
Calculador Geral do FolhaLivre

Copyright (c) 2002-2007 Allan Lima, Belém-Pará-Brasil.

Este programa é um software de livre distribuição, que pode ser copiado e
distribuído sob os termos da Licença Pública Geral GNU, conforme publicada
pela Free Software Foundation, versão 2 da licença ou qualquer versão posterior.

Este programa é distribuído na expectativa de ser útil aos seus usuários,
porém  NÃO TEM NENHUMA GARANTIA, EXPLÍCITAS OU IMPLÍCITAS,
COMERCIAIS OU DE ATENDIMENTO A UMA DETERMINADA FINALIDADE.

Consulte a Licença Pública Geral GNU para maiores detalhes.
}

{
Histórico das alterações
========================

* 25/05/2005 - Adicionado situação de funcionários por tipo de folha.
               Tabela: F_FOLHA_TIPO_SITUACAO, Unidade: ffolha_tipo.pas
* 06/06/2005 - Adicionado as funções XE e XI.
* 19/06/2005 - Adicionado o cálculo de folha complementar
* 10/07/2005 - Adicionado o evento complementar
* 23/08/2006 - Adicionado a função DSR() para suporte ao calculo do &quot;Descanso Semanal Remunerado&quot;;
* 01/03/2007 - Bug Fix: 1666112 - Testar Valores Minimo e Maximo
* 01/03/2007 - Bug fix: 1672060 - Salário Mensal e Salário
* 03/03/2007 - Adicionado a função MAA() - Meses de Admissão no Ano;
* 03/03/2007 - Adicionado a função MM() - Meses para Média;
* 06/03/2007 - Adicionado a função GN() - Gratificação Natalina;
* 08/03/2007 - Adicionado a função PDF() - Domingos e Feriados no Periodo;
* 08/03/2007 - Adicionado a função PDU() - Dias Uteis no Periodo;
* 18/03/2007 - Adicionado a função SN() - Salario Normal;
* 01/04/2007 - Adicionado Eventos Programados.
               Tabela: F_PROGRAMADO, Unidade: fprogramado.pas;
* 04/10/2007 - Adicionado o recurso de transação (start/rollback/commit);
* 07/01/2008 - Reimplementação da função Totalizador().
}

</span><span class="pas1-preprocessor">{$IFNDEF QFLIVRE}
</span><span class="pas1-reservedword">unit</span><span class="pas1-space"> </span><span class="pas1-identifier">fcalculador</span><span class="pas1-symbol">;
{$ENDIF}

{$IFNDEF NO_FLIVRE.INC}
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$I flivre.inc}
{$ENDIF}

</span><span class="pas1-reservedword">interface

uses
</span><span class="pas1-space">  </span><span class="pas1-identifier">SysUtils</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Classes</span><span class="pas1-symbol">,
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF CLX}</span><span class="pas1-identifier">QControls</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">QDialogs</span><span class="pas1-symbol">,{$ENDIF}
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF VCL}</span><span class="pas1-identifier">Controls</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Dialogs</span><span class="pas1-symbol">,{$ENDIF}
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF ADO}</span><span class="pas1-identifier">ADODB</span><span class="pas1-symbol">,{$ENDIF}
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF IBX}</span><span class="pas1-identifier">IBDatabase</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">IBCustomDataSet</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">IBQuery</span><span class="pas1-symbol">,{$ENDIF}
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFNDEF DEBUG}</span><span class="pas1-identifier">fprogress</span><span class="pas1-symbol">,{$ENDIF}
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF FL_MIDASLIB}</span><span class="pas1-identifier">MidasLib</span><span class="pas1-symbol">,{$ENDIF}
</span><span class="pas1-space">  </span><span class="pas1-identifier">DB</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">DBClient</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Variants</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">AKExpression</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">type
</span><span class="pas1-space">  </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-reservedword">class
</span><span class="pas1-space">  </span><span class="pas1-reservedword">protected
</span><span class="pas1-space">    </span><span class="pas1-preprocessor">{$IFNDEF DEBUG}
</span><span class="pas1-space">    </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TFrmProgress</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-preprocessor">{$ENDIF}
</span><span class="pas1-space">    </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TAKExpression</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdInformado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdAutomatico</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdProgramado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdDependenteTipo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdCentralFunc</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaGlobal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaLocal</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdTabelaGlobalItem</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaLocalItem</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">LocalEvaluate</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sender</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TObject</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">array</span><span class="pas1-space"> </span><span class="pas1-reservedword">of</span><span class="pas1-space"> </span><span class="pas1-identifier">Variant</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">ArgCount</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Variant</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Done</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">LocalVariable</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sender</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TObject</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Variant</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Done</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">private

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSituacao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvVinculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvTipoSalario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEventoEntrada</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvEventoNome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvCausaRescisao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvCompetencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvGE</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvGP</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSindicato</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 29/05/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDemissao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvFolhaComplementar</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 19/06/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDiasPagamento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">SmallInt</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">,
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvBase</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDesconto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvProvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDSR</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasNaoUteis</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Delete</span><span class="pas1-symbol">:</span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">Commit</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">AtualizaIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-comment">// funcoes de manipulacao de Valores
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor Local
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor Global
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor Local
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor Global
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">// funcoes de manipulacao de indices
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Indices</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Data</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">                      </span><span class="pas1-identifier">Erro</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Local ou Global
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Local
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Global

</span><span class="pas1-space">    </span><span class="pas1-comment">// funcoes de manipulacao de tabelas
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Tabela Local
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Global
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Tabela Local ou Global
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGeralItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorMaximoEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorMinimoEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidenciaNome</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TempoServico</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Dependente</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">                         </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">                         </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Invalido</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">                              </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">                              </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Invalido</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TempoNascimento</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Proporcional</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Proporcional</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">overload</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">SalarioNormal</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space">    
    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">PesquisaValorInformado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Formula</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">NumeroDiasInativos</span><span class="pas1-symbol">();

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">SetInformado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">SetReferencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">SetTotalizado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">// função XI&lt;i&gt; ou XI(&lt;i&gt;,&lt;mes&gt;,&lt;ano&gt;)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Mes</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Ano</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">// função XE&lt;e&gt; ou XE(&lt;e&gt;,&lt;mes&gt;,&lt;ano&gt;)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Mes</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Ano</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorBase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 19/06/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-comment">{ Descanso Semanal Remunerado }
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">DSR</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 23/08/2006 - allan_kardek }
</span><span class="pas1-space">    </span><span class="pas1-comment">{ Meses de Admissao no Ano }
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">MAA</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 03/03/2007 - allan_kardek }
</span><span class="pas1-space">    </span><span class="pas1-comment">{ Meses para Media }
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">MM</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 03/03/2007 - allan_kardek }
</span><span class="pas1-space">    </span><span class="pas1-comment">{ Gratificacao Natalina - 13o. salario }
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">GN</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasNaoUteis</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">{ 03/03/2007 - allan_kardek }
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasUteis</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">public
</span><span class="pas1-space">    </span><span class="pas1-reservedword">constructor</span><span class="pas1-space"> </span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">destructor</span><span class="pas1-space"> </span><span class="pas1-identifier">Destroy</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">override</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">doCalculate</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">InitDatabase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDataSet</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">kCalculador</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Limpar</span><span class="pas1-symbol">:</span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-space"> </span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(
</span><span class="pas1-space">  </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TipoFolha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Totalizado</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Totalizador</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Total</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">BaseAcumulacao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">GE</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Base</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">implementation

uses</span><span class="pas1-space"> </span><span class="pas1-identifier">fdb</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">ftext</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cDateTime</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">fdata</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Math</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">DateUtils</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">const
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_EV_NAO_CALCULAR</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ Não calcular para folha complementar }
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_EV_COMPLEMENTAR</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ Paga apenas a diferença }
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_EV_TOTAL</span><span class="pas1-space">        </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ Paga o total calculado }
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-space">  </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'Número de parametros incorreto'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_COMPETENCIAS</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">array</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">..</span><span class="pas1-number">13</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">of</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=
</span><span class="pas1-space">    </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'JANEIRO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-string">'FEVEREIRO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'MARCO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-string">'ABRIL_X'</span><span class="pas1-symbol">,</span><span class="pas1-space">    </span><span class="pas1-string">'MAIO_X'</span><span class="pas1-symbol">,
</span><span class="pas1-space">      </span><span class="pas1-string">'JUNHO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space">    </span><span class="pas1-string">'JULHO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space">     </span><span class="pas1-string">'AGOSTO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'SETEMBRO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'OUTUBRO_X'</span><span class="pas1-symbol">,
</span><span class="pas1-space">      </span><span class="pas1-string">'NOVEMBRO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'DEZEMBRO_X'</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-string">'SALARIO13_X'</span><span class="pas1-symbol">);


</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">kCalculador</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDataSet</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Limpar</span><span class="pas1-symbol">:</span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-space"> </span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">Frm</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-comment">// Cria o objeto interno de calculo
</span><span class="pas1-space">  </span><span class="pas1-identifier">Frm</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">kStartTransaction</span><span class="pas1-symbol">();

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try</span><span class="pas1-space"> </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">Frm</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvFolha</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">InitDatabase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-preprocessor">{$IFNDEF DEBUG}
</span><span class="pas1-space">      </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">MaxValue</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RecordCount</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-preprocessor">{$ENDIF}

</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EOF</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-preprocessor">{$IFNDEF DEBUG}
</span><span class="pas1-space">        </span><span class="pas1-comment">// Apresenta o progresso do calculo por funcionários
</span><span class="pas1-space">        </span><span class="pas1-comment">{
        FProgresso.Mensagem :=
           DataSet.FieldByName('NOME').AsString+' - '+
             'De '+IntToStr(DataSet.RecNo)+' a '+IntToStr(FProgresso.MaxValue);
        }
</span><span class="pas1-space">        </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddProgress</span><span class="pas1-symbol">(</span><span class="pas1-number">1</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-preprocessor">{$ENDIF}

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldCount</span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Limpar</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">Delete</span><span class="pas1-symbol">()
</span><span class="pas1-space">          </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">doCalculate</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'kCalculador()'</span><span class="pas1-symbol">);

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// while

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">except
</span><span class="pas1-space">    </span><span class="pas1-reservedword">on</span><span class="pas1-space"> </span><span class="pas1-identifier">E</span><span class="pas1-symbol">:</span><span class="pas1-identifier">Exception</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">kInTransaction</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">kRollbackTransaction</span><span class="pas1-symbol">();
</span><span class="pas1-space">      </span><span class="pas1-identifier">kErro</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">E</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'fcalculador'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'kCalculador()'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">kInTransaction</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">kCommitTransaction</span><span class="pas1-symbol">();
</span><span class="pas1-space">    </span><span class="pas1-identifier">Frm</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">constructor</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">inherited</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdDependenteTipo</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdCentral</span><span class="pas1-space">          </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdCentralFunc</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdFolha</span><span class="pas1-space">            </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-space">        </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdInformado</span><span class="pas1-space">        </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdAutomatico</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdProgramado</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);</span><span class="pas1-space"> </span><span class="pas1-comment">{ 01/04/2007 - allan_kardek }
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-space">           </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-space">         </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);</span><span class="pas1-space"> </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);</span><span class="pas1-space"> </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaGlobal</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaLocal</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaGlobalItem</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaLocalItem</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">FExpression</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TAKExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">FExpression</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">OnEvaluate</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">LocalEvaluate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">OnVariable</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">LocalVariable</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">E</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">F</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">L</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">R</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">{ 29/05/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvDSR</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvDiasNaoUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFNDEF DEBUG}
</span><span class="pas1-space">  </span><span class="pas1-identifier">FProgresso</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">CriaProgress</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Rotulo</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Visible</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Bar</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Align</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">alClient</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Bar</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Font</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Size</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Bar</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Font</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Size</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$ENDIF}

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// create

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">InitDatabase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDataSet</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">iCount</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT F.*, GP.IDGE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM F_FOLHA F, F_GRUPO_PAGAMENTO GP'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :EMPRESA AND F.IDFOLHA = :FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND GP.IDGP = F.IDGP'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-string">'ARQUIVAR_X'</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">     </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ARQUIVAR_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'A folha de pagamento já está arquivada,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'por isso não pode ser calculada.'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">''</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'Verifique o cadastro da folha.'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">kSQLSelectFrom</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdDependenteTipo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_DEPENDENTE_TIPO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">kSQLSelectFrom</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_CENTRAL'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'IDEMPRESA IS NULL'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">kSQLSelectFrom</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentralFunc</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_CENTRAL_FUNCIONARIO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldDefs</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDINCIDENCIA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">ftInteger</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldDefs</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">ftString</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">30</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldDefs</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTAL'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">ftCurrency</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_INCIDENCIA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-space">         </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDFOLHA_TIPO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvInicio</span><span class="pas1-space">            </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'PERIODO_INICIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvFim</span><span class="pas1-space">               </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'PERIODO_FIM'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvCompetencia</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'COMPETENCIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvGE</span><span class="pas1-space">                </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDGE'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvGP</span><span class="pas1-space">                </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDGP'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvCredito</span><span class="pas1-space">           </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'DATA_CREDITO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvFolhaComplementar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-string">'COMPLEMENTAR_X'</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvFolhaComplementar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'COMPLEMENTAR_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 19/06/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// with qry_Folha

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RecordCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-comment">// Limpa da folha atual todos os funcionários já calculados

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'DELETE FROM F_CENTRAL_FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'WHERE IDEMPRESA = :EMPRESA AND IDFOLHA = :FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">kExecSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-comment">// Conta a qtde de situações de funcionario para o tipo da folha
</span><span class="pas1-space">    </span><span class="pas1-comment">// Considera apenas os funcionários com situações listadas para o tipo da folha

</span><span class="pas1-space">    </span><span class="pas1-identifier">iCount</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">kExistTable</span><span class="pas1-symbol">(</span><span class="pas1-string">'F_FOLHA_TIPO_SITUACAO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 25/05/2005 - allan_lima }
</span><span class="pas1-space">      </span><span class="pas1-identifier">iCount</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F_FOLHA_TIPO_SITUACAO'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                           </span><span class="pas1-string">'IDFOLHA_TIPO = :TIPO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-comment">// Seleciona os funcionários para o cálculo

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDFUNCIONARIO, P.NOME, 1 AS X'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  FUNCIONARIO F, PESSOA P'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  , F_RESCISAO_CONTRATO RC'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  , F_SITUACAO S'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDGP = :GP'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Folha de Rescisao
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin</span><span class="pas1-space">  </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND RC.IDEMPRESA = F.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND RC.IDFUNCIONARIO = F.IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND RC.IDFOLHA = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin</span><span class="pas1-space">  </span><span class="pas1-comment">{ 07/12/2004 - allan_lima }
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND S.IDSITUACAO = F.IDSITUACAO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND S.CALCULAR_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin</span><span class="pas1-space">  </span><span class="pas1-comment">{ 25/05/2005 - allan_lima }
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDSITUACAO IN'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'    (SELECT S.IDSITUACAO FROM F_FOLHA_TIPO_SITUACAO S'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'     WHERE S.IDFOLHA_TIPO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">)+</span><span class="pas1-string">')'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND P.IDEMPRESA = F.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND P.IDPESSOA = F.IDPESSOA'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvGP</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  S.*, E.*, E.NOME AS EVENTO,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  FS.FORMULA AS FORMULA_SEQUENCIA,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  FE.FORMULA AS FORMULA_EVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_SEQUENCIA S, F_FORMULA FS, F_EVENTO E, F_FORMULA FE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  S.IDGP = :IDGP'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND FS.IDFORMULA = S.IDFORMULA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND E.IDEVENTO = S.IDEVENTO AND E.ATIVO_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND FE.IDFORMULA = E.IDFORMULA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'ORDER BY'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  S.SEQUENCIA, S.IDEVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvGP</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-comment">// Eventos padrao para tipo de folha

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT * FROM F_PADRAO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE IDGP = :IDGP'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFOLHA_TIPO = :IDTIPO_FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">C_COMPETENCIAS</span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvCompetencia</span><span class="pas1-symbol">]+</span><span class="pas1-string">' = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'ORDER BY'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  IDEVENTO, IDTIPO, IDSITUACAO, IDVINCULO, IDSALARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvGP</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_VALOR_FIXO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-string">'F_VALOR_FIXO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT T.* FROM F_TABELA_FAIXA T'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  T.IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND T.COMPETENCIA ='</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'    (SELECT MAX(COMPETENCIA) FROM F_TABELA_FAIXA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'     WHERE IDEMPRESA = T.IDEMPRESA AND'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'           IDTABELA = T.IDTABELA AND COMPETENCIA &lt;= :DATA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'ORDER BY'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  T.IDTABELA, T.FAIXA'</span><span class="pas1-symbol">);</span><span class="pas1-space">  </span><span class="pas1-comment">// DESC edimilson
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaGlobal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaLocal</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug corrigido em 07/06/2005 - allan_lima }

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  I.IDTABELA, I.ITEM, I.VALOR'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_TABELA_ITEM I'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  I.IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND I.COMPETENCIA ='</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'    (SELECT MAX(COMPETENCIA) FROM F_TABELA_ITEM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'     WHERE IDEMPRESA = I.IDEMPRESA AND'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'           IDTABELA = I.IDTABELA AND COMPETENCIA &lt;= :DATA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'ORDER BY'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  I.IDTABELA, I.ITEM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaGlobalItem</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaLocalItem</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// proc InitDataBase

{ Funcoes de Valores Fixos }

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDVFIXO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-string">'Valor Fixo %d não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">]);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function ValorLocal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-string">'Valor Fixo %s não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">]);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function ValorLocal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDVFIXO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-string">'Valor Fixo %d não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">]);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function ValorGlobal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-string">'Valor Fixo %s não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">]);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function ValorGlobal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDVFIXO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDVFIXO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-string">'Valor Fixo %d não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">]);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function ValorGeral

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-string">'Valor Fixo %s não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">]);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function ValorGeral

{ Funcoes de Indices }

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Indices</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Data</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Erro</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Erro</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">     </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F_INDICE'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                  </span><span class="pas1-string">'IDEMPRESA = :EMPRESA AND IDINDICE = :INDICE'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                  </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'Índice '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">)+</span><span class="pas1-string">' não existe'</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.00</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT VALOR'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM F_INDICE_VALOR V'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  V.IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND V.IDINDICE = :INDICE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND V.COMPETENCIA ='</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'    ( SELECT MAX(I.COMPETENCIA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      FROM F_INDICE_VALOR I'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      WHERE I.IDEMPRESA = V.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'            AND I.IDINDICE = V.IDINDICE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'            AND I.COMPETENCIA &lt;= :DATA )'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// function Indices

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">IndiceGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">try
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Indices</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">except
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Indices</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function IndiceLocal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">IndiceLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Indices</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function IndiceLocal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">IndiceGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Indices</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Indice</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function IndiceGlobal

{ Funcoes de Tabelas }

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TabelaLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cDeduzir</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaLocal</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tabela</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTABELA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FAIXA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TAXA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">cDeduzir</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'REDUZIR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ACRESCENTAR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">Result</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">*</span><span class="pas1-identifier">pvTaxa</span><span class="pas1-symbol">*</span><span class="pas1-float">0.01</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">cDeduzir</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IfThen</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-symbol">-</span><span class="pas1-identifier">cDeduzir</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-identifier">Break</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Tabela Local %d não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">]);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function TabelaLocal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TabelaLocalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaLocalItem</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tabela</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTABELA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">         </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Item</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ITEM'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">Break</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// with cdTabelaLocalItem

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Item %d da Tabela Local %d não existe.'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                 </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Item</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">]);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function TabelaLocalItem

// Tabela Global - Pesquisa na tabela o valor da Faixa
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TabelaGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cDeduzir</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaGlobal</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tabela</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTABELA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FAIXA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TAXA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">cDeduzir</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'REDUZIR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ACRESCENTAR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">Result</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">*</span><span class="pas1-identifier">pvTaxa</span><span class="pas1-symbol">*</span><span class="pas1-float">0.01</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">cDeduzir</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IfThen</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cAcrescentar</span><span class="pas1-symbol">-</span><span class="pas1-identifier">cDeduzir</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-identifier">Break</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Tabela Global '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">)+</span><span class="pas1-string">' não existe.'</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function TabelaGlobal;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TabelaGeralItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">except
</span><span class="pas1-space">    </span><span class="pas1-reservedword">try
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">except
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Item %d da Tabela de Cálculo %d não existe.'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                 </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Item</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">]);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function TabelaGeralItem

// Tabela Geral - Pesquisa na tabela o valor da Faixa
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TabelaGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">except
</span><span class="pas1-space">    </span><span class="pas1-reservedword">try
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">except
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Tabela de Cálculo %d não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">]);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function TabelaGeral;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TabelaGlobalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Item</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTabelaGlobalItem</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tabela</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTABELA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">         </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Item</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ITEM'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">Break</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">   </span><span class="pas1-comment">// with cdTabelaGlobalItem

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bFound</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'O item %d da Tabela Global %d não existe.'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                               </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Item</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Tabela</span><span class="pas1-symbol">]);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function TabelaGeralItem

// Evento - Retorna o valor de determinado campo de um evento em deteminada folha
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdLocal</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Folha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// verifica na folha atual (em calculo)
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Campo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'LIQUIDO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdLocal</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">nil</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">+</span><span class="pas1-string">', LIQUIDO FROM F_CENTRAL'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFOLHA = :IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFUNCIONARIO = :IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDEVENTO = :IDEVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdLocal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">kGetErrorLastSQL</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RecordCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Campo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// function Evento

// Evento - Retorna o valor de determinado campo de um evento em deteminada folha
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Codigo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Campo</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorMaximoEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR_MAXIMO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorMinimoEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR_MINIMO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-comment">{ ContraPartida - Contra Partida
  Retorna o total de valores calculados de uma Evento
  das folhas anexas a folha atual }
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.00</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT SUM(CALCULADO) FROM  F_CENTRAL'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFOLHA IN ('</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'        SELECT IDFOLHA_CP FROM F_FOLHA_CP'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'        WHERE IDEMPRESA = F_CENTRAL.IDEMPRESA AND IDFOLHA = :IDFOLHA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFUNCIONARIO = :IDFUNCIONARIO  AND IDEVENTO = :IDEVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">kGetErrorLastSQL</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">));
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-comment">{ Dados do Funcionario }

{ TempoServico - Retorna em meses o tempo de servico }
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TempoServico</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DiffMonths</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF DEBUG}
</span><span class="pas1-space">  </span><span class="pas1-identifier">ShowMessage</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Tempo de servico = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Result</span><span class="pas1-symbol">)+</span><span class="pas1-string">' mes(es)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$ENDIF}
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Invalido</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT COUNT(*) FROM F_DEPENDENTE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  IDEMPRESA = :EMPRESA AND IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'AND TIPO LIKE '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-string">'%'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">)+</span><span class="pas1-string">'%'</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sexo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">in</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-string">'m'</span><span class="pas1-symbol">,</span><span class="pas1-string">'f'</span><span class="pas1-symbol">,</span><span class="pas1-string">'M'</span><span class="pas1-symbol">,</span><span class="pas1-string">'F'</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'AND SEXO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">)));
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Invalido</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Invalido</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">in</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-string">'i'</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'AND INVALIDO_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function DependenteGeral

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Dependente</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Invalido</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">iLimite</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">dNasc</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iLimite</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Length</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'Tipo de dependente inválido - &quot;'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">+</span><span class="pas1-string">'&quot;.'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdDependenteTipo</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDTIPO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">iLimite</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdDependenteTipo</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'LIMITE_ANO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT * FROM F_DEPENDENTE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  IDEMPRESA = :EMPRESA AND IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'AND TIPO LIKE '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-string">'%'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-symbol">)+</span><span class="pas1-string">'%'</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sexo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">in</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-string">'m'</span><span class="pas1-symbol">,</span><span class="pas1-string">'f'</span><span class="pas1-symbol">,</span><span class="pas1-string">'M'</span><span class="pas1-symbol">,</span><span class="pas1-string">'F'</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'AND SEXO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sexo</span><span class="pas1-symbol">)));
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Invalido</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Invalido</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">in</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-string">'i'</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'AND INVALIDO_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Tipo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RecordCount
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">dNasc</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'NASCIMENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'INVALIDO_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or
</span><span class="pas1-space">          </span><span class="pas1-symbol">(</span><span class="pas1-identifier">kIdade</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">dNasc</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;=</span><span class="pas1-space"> </span><span class="pas1-identifier">iLimite</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">Inc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Result</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function Dependente

// TempoNascimento - Retorna em meses a idade do funcionario
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TempoNascimento</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug: Quanto a data de nascimento está vazia o tempo de nascimento retornado é muito grande }
</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug reportado por Edimilson [edivaires@yahoo.com.br]
    em 19-10-2005 na mensagem 759 - br.groups.yahoo.com/groups/folha_livre }
</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug eliminado por Allan [allan_kardek@yahoo.com.br] em 21-10-2005 }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'NASCIMENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">IsNull</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DiffMonths</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'NASCIMENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;


</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Proporcional</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">iHorasFalta</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvEventoEntrada</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">/</span><span class="pas1-number">30</span><span class="pas1-symbol">)*(</span><span class="pas1-number">30</span><span class="pas1-symbol">-</span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-symbol">)
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">iHorasFalta</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">((</span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-symbol">*(</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">/</span><span class="pas1-number">30</span><span class="pas1-symbol">)));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">/</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">)*(</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">-</span><span class="pas1-identifier">iHorasFalta</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Proporcional</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Proporcional</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToFloat</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">))));
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function Proporcional

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AtualizaIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCampo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cTotal</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TIPO_EVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'B'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">sCampo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'INC_'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">kStrZero</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)+</span><span class="pas1-string">'_X'</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">cTotal</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCampo</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">        </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCampo</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">Edit</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'P'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cTotal</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cTotal</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">Post</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// while not Eof do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// with cdIncidencias

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// proc AtualizaIncidencia

// Total de incidencia

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-space"> </span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDINCIDENCIA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFDEF DEBUG}
</span><span class="pas1-space">  </span><span class="pas1-identifier">ShowMessage</span><span class="pas1-symbol">(</span><span class="pas1-string">'O total de incidencia ('</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">)+</span><span class="pas1-string">') = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">CurrToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Result</span><span class="pas1-symbol">));
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$ENDIF}
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// func TI

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-space"> </span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">));
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">TotalIncidenciaNome</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">iIncidencia</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Nome</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">iIncidencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-identifier">iIncidencia</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Delete</span><span class="pas1-symbol">:</span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'DELETE FROM F_CENTRAL_FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFOLHA = :IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFUNCIONARIO = :IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-comment">// Bug fix: [1674913] Transaction is not active
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kExecSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">kGetErrorLastSQL</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Commit</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">i</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-comment">// Incluir Informacoes sobre o Funcionario no momento do Calculo

</span><span class="pas1-space">  </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentralFunc</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-identifier">Close</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">CreateDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Append</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">for</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldCount</span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">].</span><span class="pas1-identifier">FieldName</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">].</span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">].</span><span class="pas1-identifier">FieldName</span><span class="pas1-symbol">).</span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEMPRESA'</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEMPRESA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDFOLHA'</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDFOLHA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">Post</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kSQLInsert</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentralFunc</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_CENTRAL_FUNCIONARIO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">kGetErrorLastSQL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-comment">// Incluir os Eventos Calculados para o Funcionario
</span><span class="pas1-space">  </span><span class="pas1-identifier">kSQLInsertDataSet</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_CENTRAL'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// procedure Commit

</span><span class="pas1-reservedword">destructor</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Destroy</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$IFNDEF DEBUG}
</span><span class="pas1-space">  </span><span class="pas1-identifier">FProgresso</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-preprocessor">{$ENDIF}

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdCentralFunc</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdDependenteTipo</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdValorLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdValorGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaLocal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaLocalItem</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaGlobal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTabelaGlobalItem</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdInformado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdAutomatico</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdProgramado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;</span><span class="pas1-space">        </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">inherited</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">doCalculate</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iContraPartida</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iComplementar</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sFormula</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaPadrao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaSequencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-symbol">,
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cCalculado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cMinimo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cMaximo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bAssumeValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bTestarMinimoMaximo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bProporcional</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bCalcular</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">   </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-identifier">pvBase</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvDesconto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvProvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Close</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateDataSet</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">// Ao iniciar o calculo para o funcionario zerar os totalizadores
</span><span class="pas1-space">   </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">   </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">     </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">     </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">     </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">       </span><span class="pas1-identifier">Edit</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">Post</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">     </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-identifier">Delete</span><span class="pas1-symbol">();

</span><span class="pas1-space">   </span><span class="pas1-comment">// Carrega informações do funcionário

</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.*, P.*'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  FUNCIONARIO F, PESSOA P'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFUNCIONARIO = :IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND P.IDEMPRESA = F.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND P.IDPESSOA = F.IDPESSOA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">   </span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CARGA_HORARIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvTipo</span><span class="pas1-space">         </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTIPO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSituacao</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSITUACAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvVinculo</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDVINCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvTipoSalario</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ADMISSAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvDemissao</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'DEMISSAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">{ 29/05/2005 - allan_lima }
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSindicato</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSINDICATO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">// Carrega informações sobre a rescisão do funcionario

</span><span class="pas1-space">   </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 28/05/2005 - allan_lima }
</span><span class="pas1-space">   </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT * FROM F_RESCISAO_CONTRATO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND IDFOLHA = :FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">     </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">     </span><span class="pas1-identifier">pvCausaRescisao</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDRESCISAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT R.*, F.FORMULA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM F_RESCISAO_EVENTO R'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'LEFT JOIN F_FORMULA F ON (R.IDFORMULA = F.IDFORMULA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE R.IDGP = :GP AND R.IDRESCISAO = :RESCISAO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">     </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvGP</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvCausaRescisao</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">   </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">     </span><span class="pas1-identifier">pvCausaRescisao</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">// Lancamentos manuais efetuados para a folha
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT IDEVENTO, INFORMADO FROM F_INFORMADO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE  IDEMPRESA = :IDEMPRESA AND IDFOLHA = :IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'       AND IDFUNCIONARIO = :IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">// Bug fix: [1674913] Transaction is not active
</span><span class="pas1-space">   </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdInformado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">   </span><span class="pas1-comment">// Lancamentos automáticos efetuados para funcionario
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT IDEVENTO, INFORMADO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM   F_AUTOMATICO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE  IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND IDFUNCIONARIO = :IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND IDFOLHA_TIPO = :IDTIPO_FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">C_COMPETENCIAS</span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvCompetencia</span><span class="pas1-symbol">]+</span><span class="pas1-string">' = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">// Bug fix: [1674913] Transaction is not active
</span><span class="pas1-space">   </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdAutomatico</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">   </span><span class="pas1-comment">// Lancamentos programados para funcionario
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT IDEVENTO, INFORMADO FROM F_PROGRAMADO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE  IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND IDFUNCIONARIO = :IDFUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND IDFOLHA_TIPO = :IDTIPO_FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND SUSPENSO_X = 0'</span><span class="pas1-symbol">);
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'   AND INICIO &lt;= :INICIO AND TERMINO &gt;= :FIM'</span><span class="pas1-symbol">);</span><span class="pas1-space">  </span><span class="pas1-comment">// Bug fix: 1805573
</span><span class="pas1-space">   </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdProgramado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">             </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">   </span><span class="pas1-identifier">NumeroDiasInativos</span><span class="pas1-symbol">();

</span><span class="pas1-space">   </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">30</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">     </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;

</span><span class="pas1-space">   </span><span class="pas1-comment">// Percorre cdSequencia para que o calculo obedeca a sequencia de calculo

</span><span class="pas1-space">   </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">   </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">     </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">     </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">EOF</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">     </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">       </span><span class="pas1-identifier">pvTaxa</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">       </span><span class="pas1-identifier">pvEvento</span><span class="pas1-space">          </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvEventoNome</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'EVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TIPO_EVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TIPO_CALCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">iContraPartida</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CONTRA_PARTIDA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvEventoEntrada</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR_HORA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">       </span><span class="pas1-identifier">sFormulaPadrao</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">sFormulaSequencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FORMULA_SEQUENCIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FORMULA_EVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FORMULA_LOCAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">       </span><span class="pas1-identifier">bAssumeValor</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ASSUME_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">);
</span><span class="pas1-space">       </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'MULTIPLICADOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">       </span><span class="pas1-identifier">bProporcional</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'PROPORCIONAL_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">);

</span><span class="pas1-space">       </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-string">'COMPLEMENTAR'</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">{ 10/07/2005 - allan_lima }
</span><span class="pas1-space">         </span><span class="pas1-identifier">iComplementar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'COMPLEMENTAR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger
</span><span class="pas1-space">       </span><span class="pas1-reservedword">else
</span><span class="pas1-space">         </span><span class="pas1-identifier">iComplementar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_EV_COMPLEMENTAR</span><span class="pas1-symbol">;

</span><span class="pas1-space">       </span><span class="pas1-identifier">bCalcular</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// O evento é normalmente calculado { 10/07/2005 - allan_lima }

</span><span class="pas1-space">       </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolhaComplementar</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iComplementar</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_EV_NAO_CALCULAR</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">         </span><span class="pas1-identifier">bCalcular</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 10/07/2005 - allan_lima }

</span><span class="pas1-space">       </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">bCalcular</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-identifier">PesquisaValorInformado</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaPadrao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">       </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">         </span><span class="pas1-comment">// Nesse momento avalia e retorna o valor calculado para a formula

</span><span class="pas1-space">         </span><span class="pas1-reservedword">try

</span><span class="pas1-space">           </span><span class="pas1-identifier">bTestarMinimoMaximo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;
</span><span class="pas1-space">           </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaPadrao</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">             </span><span class="pas1-comment">// A formula padrao tem prioridade sobre todas as outras informacoes do evento
</span><span class="pas1-space">             </span><span class="pas1-identifier">sFormula</span><span class="pas1-space">         </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaPadrao</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormula</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AsDouble</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaSequencia</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">             </span><span class="pas1-comment">// A formula definida na sequencia tem prioridade sobre todas
</span><span class="pas1-space">             </span><span class="pas1-comment">// as outras informacoes do evento
</span><span class="pas1-space">             </span><span class="pas1-identifier">sFormula</span><span class="pas1-space">         </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaSequencia</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormula</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AsDouble</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">bAssumeValor</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">             </span><span class="pas1-comment">// SE ASSUME_X estiver ativado, considera o valor informado
</span><span class="pas1-space">             </span><span class="pas1-comment">// desprezando outras configuracoes
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado

</span><span class="pas1-space">           </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Contra Partida
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-identifier">iContraPartida</span><span class="pas1-symbol">)

</span><span class="pas1-space">           </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Dia Trabalhado
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">             </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-number">30</span><span class="pas1-symbol">);</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor do Dia trabalhado
</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvEventoEntrada</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'H'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">/</span><span class="pas1-number">30</span><span class="pas1-symbol">);
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">bTestarMinimoMaximo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'H'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Hora Trabalhada
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">             </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvEventoEntrada</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space">  </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">/</span><span class="pas1-number">30</span><span class="pas1-symbol">);
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">bTestarMinimoMaximo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor Informado
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado

</span><span class="pas1-space">           </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Formula
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaEvento
</span><span class="pas1-space">             </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">             </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">               </span><span class="pas1-identifier">sFormula</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">;
</span><span class="pas1-space">               </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AsDouble</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-comment">// bTestarMinimoMaximo := True;
</span><span class="pas1-space">             </span><span class="pas1-comment">{ Bug Fix: 1666112; Open Date: 22/02/2007; Close Date: 01/03/2007;  Close Developer: allan_kardek }

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">bTestarMinimoMaximo</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">bProporcional</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Proporcional</span><span class="pas1-symbol">(</span><span class="pas1-identifier">cCalculado</span><span class="pas1-symbol">);

</span><span class="pas1-space">             </span><span class="pas1-identifier">cMinimo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorMinimoEvento</span><span class="pas1-symbol">();
</span><span class="pas1-space">             </span><span class="pas1-identifier">cMaximo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorMaximoEvento</span><span class="pas1-symbol">();

</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMinimo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">cMinimo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.01</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMaximo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">cMaximo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">MaxCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-identifier">cMinimo</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-space"> </span><span class="pas1-comment">{cMinimo}</span><span class="pas1-space"> </span><span class="pas1-comment">{ 07/06/2005 - allan_lima}
</span><span class="pas1-space">             </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">cMaximo</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cMaximo</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">           </span><span class="pas1-comment">// Realiza o arrendondamento do valor calculado para duas casas decimais
</span><span class="pas1-space">           </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Math</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RoundTo</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">2</span><span class="pas1-symbol">);

</span><span class="pas1-space">           </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolhaComplementar</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space">  </span><span class="pas1-comment">{ 19/06/2005 - allan_lima }
</span><span class="pas1-space">              </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iComplementar</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_EV_COMPLEMENTAR</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">{ 10/07/2005 - allan_lima }
</span><span class="pas1-space">             </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorBase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">);

</span><span class="pas1-space">           </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cCalculado</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Realiza a gravação do evento
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Append</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-reservedword">for</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Count</span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">               </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Assigned</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FindField</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">].</span><span class="pas1-identifier">FieldName</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">                 </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">].</span><span class="pas1-identifier">FieldName</span><span class="pas1-symbol">).</span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">].</span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEMPRESA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDFOLHA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space">       </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDFUNCIONARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'REFERENCIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TOTALIZADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">cdCentral</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Post</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'B'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">pvBase</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvBase</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado
</span><span class="pas1-space">             </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">pvDesconto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDesconto</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado
</span><span class="pas1-space">             </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'P'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">               </span><span class="pas1-identifier">pvProvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvProvento</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-symbol">;

</span><span class="pas1-space">             </span><span class="pas1-identifier">AtualizaIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cCalculado</span><span class="pas1-symbol">);

</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">         </span><span class="pas1-reservedword">except
</span><span class="pas1-space">           </span><span class="pas1-reservedword">on</span><span class="pas1-space"> </span><span class="pas1-identifier">E</span><span class="pas1-symbol">:</span><span class="pas1-identifier">Exception</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">           </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">             </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;
</span><span class="pas1-space">             </span><span class="pas1-identifier">kErro</span><span class="pas1-symbol">(</span><span class="pas1-string">'Erro na execução da fórmula'</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+
</span><span class="pas1-space">                   </span><span class="pas1-string">'Evento: '</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+
</span><span class="pas1-space">                   </span><span class="pas1-string">'Formula'</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+
</span><span class="pas1-space">                   </span><span class="pas1-identifier">sFormula</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">sLineBreak</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">E</span><span class="pas1-symbol">.</span><span class="pas1-reservedword">Message</span><span class="pas1-symbol">);
</span><span class="pas1-space">             </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;
</span><span class="pas1-space">           </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// on E:Exception
</span><span class="pas1-space">         </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// try - except

</span><span class="pas1-space">       </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// if bCalcular

</span><span class="pas1-space">       </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">     </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// while not cdSequencia.EOF do

</span><span class="pas1-space">   </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// with cdSequencia do

</span><span class="pas1-space">   </span><span class="pas1-comment">// Grava todos os eventos calculados para o funcionario em F_CENTRAL
</span><span class="pas1-space">   </span><span class="pas1-identifier">Commit</span><span class="pas1-symbol">();

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-comment">// HoraNormal - Retorna o valor da hora normal do funcionario
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'05'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'SALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">SalarioNormal</span><span class="pas1-symbol">()/</span><span class="pas1-identifier">pvCargaHoraria</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// HoraNormal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">SalarioNormal</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cSalario</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iCargaHoraria</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug fix: 1672060; Open Date: 01/03/2007; Close Date: 01/03/2007; Close Developer: allan_kardek }

</span><span class="pas1-space">  </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'SALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iCargaHoraria</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CARGA_HORARIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'02'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Quizenalista
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-float">2.0

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'03'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Semanalista
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">7.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-float">30.0

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'04'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Diarista
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-float">30.0

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'05'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Horista
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">iCargaHoraria</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">RoundTo</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">2</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">   </span><span class="pas1-comment">// SalarioNormal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cSalario</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iCargaHoraria</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug fix: 1672060; Open Date: 01/03/2007;
    Close Date: 01/03/2007; Close Developer: allan_kardek }

</span><span class="pas1-space">  </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'SALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iCargaHoraria</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CARGA_HORARIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'01'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Mensalista
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">30.0</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">30.0
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'02'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Quizenalista
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">30.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">30.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'03'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Semanalista
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">30.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">7.0</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'04'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Diarista
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">30.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTipoSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'05'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Horista
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">iCargaHoraria</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">RoundTo</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cSalario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">2</span><span class="pas1-symbol">);

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// SalarioMensal

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">PesquisaValorInformado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Formula</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">iMesDireito</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Folha de Rescisao
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin</span><span class="pas1-space">  </span><span class="pas1-comment">{ 29/05/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDSINDICATO;IDEVENTO'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                               </span><span class="pas1-identifier">VarArrayOf</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvSindicato</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-symbol">[]);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDSINDICATO;IDEVENTO'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                         </span><span class="pas1-identifier">VarArrayOf</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-symbol">[]);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">iMesDireito</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'MES_DIREITO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Formula</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisaoEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FORMULA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iMesDireito</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">TempoServico</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-identifier">iMesDireito</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">Formula</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">Result</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ Nao tem direito }
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Result

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-comment">// O valor informado em F_INFORMADO sempre terá prioridade sobre
</span><span class="pas1-space">  </span><span class="pas1-comment">// os outros valores informados

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdInformado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdInformado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdAutomatico</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-comment">// Pesquisa em cdAutomatico - F_AUTOMATICO
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdAutomatico</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdProgramado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-comment">// Pesquisa em Eventos Programados - F_PROGRAMADO
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdProgramado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Exit</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-comment">// Pesquisa em cdPadrao - F_PADRAO

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Eof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">     </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">)
</span><span class="pas1-space">              </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTIPO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'00'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or
</span><span class="pas1-space">                    </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDTIPO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipo</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">)
</span><span class="pas1-space">              </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSITUACAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'00'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or
</span><span class="pas1-space">                    </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSITUACAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSituacao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">)
</span><span class="pas1-space">              </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDVINCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'00'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or
</span><span class="pas1-space">                    </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDVINCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvVinculo</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">)
</span><span class="pas1-space">              </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'00'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or
</span><span class="pas1-space">                    </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDSALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoSalario</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Break</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">cdPadrao</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// while not Eof do

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function PesquisaValorInformado

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">NumeroDiasInativos</span><span class="pas1-symbol">();
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvDiasPagamento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">30</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">     </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Day</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">)-</span><span class="pas1-number">1</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDemissao</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDemissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">     </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDemissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDiasInativo</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDiasPagamento</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">Day</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDemissao</span><span class="pas1-symbol">));

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// proc NumeroDiasInativos

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">tkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">SetInformado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">tkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">SetReferencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">tkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">SetTotalizado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">LocalVariable</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sender</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TObject</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Variant</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Done</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-comment">// Quando Done for True o FatExpression não processa mais a variavel

</span><span class="pas1-space">  </span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Done</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VR'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvReferencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Done</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Done</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">LocalEvaluate</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Sender</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TObject</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">array</span><span class="pas1-space"> </span><span class="pas1-reservedword">of</span><span class="pas1-space"> </span><span class="pas1-identifier">Variant</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-identifier">ArgCount</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Value</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Variant</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Done</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">var

</span><span class="pas1-space">  </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Para desativar o &quot;Totalizar&quot;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cTipo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cSexo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cInvalido</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Texto</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">var
</span><span class="pas1-space">    </span><span class="pas1-identifier">a</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">Valor</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">for</span><span class="pas1-space"> </span><span class="pas1-identifier">a</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-identifier">Length</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Texto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Texto</span><span class="pas1-symbol">[</span><span class="pas1-identifier">a</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">in</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-string">'R'</span><span class="pas1-symbol">,</span><span class="pas1-string">'T'</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">)
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else
</span><span class="pas1-space">          </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">[</span><span class="pas1-identifier">a</span><span class="pas1-symbol">];
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Texto</span><span class="pas1-symbol">[</span><span class="pas1-identifier">a</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-reservedword">in</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-string">'A'</span><span class="pas1-symbol">,</span><span class="pas1-string">'Q'</span><span class="pas1-symbol">,</span><span class="pas1-string">'M'</span><span class="pas1-symbol">,</span><span class="pas1-string">'X'</span><span class="pas1-symbol">,</span><span class="pas1-string">'N'</span><span class="pas1-symbol">,</span><span class="pas1-string">'U'</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">)
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else
</span><span class="pas1-space">          </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Texto</span><span class="pas1-symbol">[</span><span class="pas1-identifier">a</span><span class="pas1-symbol">];
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// TotalCalculoValor

</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">iLen</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Length</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ========== Dados do funcionario ========== }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Codigo do Cargo
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDCARGO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CH'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Carga Horaria Mensal
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvCargaHoraria

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'GI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Grau de Instrucao
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDINSTRUCAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'HT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor da Hora Trabalhada
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'ID'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Codigo Identificador
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDFUNCIONARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'LT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Codigo da Lotacao
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDLOTACAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'MMA'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Meses de Admissão no Ano
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">MAA</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'MM'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Meses para Media
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">MM</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'SM'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor do Salario Mensal
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'SN'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor do Salario Mensal &quot;Normal&quot;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">SalarioNormal</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Bug fix: 1672060; Open Date: 01/03/2007; Close Date: 01/03/2007; Close Developer: allan_kardek }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'SALARIO'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor do Salario Básico
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'SALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TN'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tempo de nascimento em meses
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TempoNascimento</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TS'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tempo de Servico em meses
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TempoServico</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-comment">{ DSR - Descanso Semanal Remunerado }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'DSR'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DSR</span><span class="pas1-symbol">();
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ========== Contagem de Dependentes ========== }

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * DD ou DD()
    Executa a contagem geral dos dependentes desconsiderando quaisquer informações.

    * DD[t][M,F][I] ou DD([t],[M,F],[I])
    Realiza a contagem dos dependentes desconsiderando as idades e os limites
    do tipo. Se o modificador [t] for informado será considerado apenas os
    dependentes dos tipos [t]. Se o modificador opcional [M,F] for usado será
    considerado apenas os dependentes do sexo correspondente. Se o modificador
    opcional [I] for utilizado será considerado apenas os dependentes &quot;inválidos&quot;. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'DD'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">()
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">2</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'DD'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">cTipo</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSexo</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cInvalido</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr
</span><span class="pas1-space">      </span><span class="pas1-reservedword">else
</span><span class="pas1-space">        </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">cInvalido</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kRetiraChar</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'FMI'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">cTipo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">];

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DependenteGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cTipo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cSexo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cInvalido</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{
  * D[t] ou D([t])
    Executa a contagem dos dependentes do tipo [t], considerando o limite
    de idade para o tipo e o campo &quot;inválido&quot;.

  * D[t][M,F][I] ou D([t],[M,F],[I])
    Realiza a contagem dos dependentes considerando o limite de idade quando o
    tipo for especificado. Se o modificador opcional [M,F] for usado será
    considerado apenas os dependentes de sexo correspondente. Se o modificador
    opcional [I] for utilizado será considerado apenas os dependentes &quot;inválidos&quot;.
  }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Dependente</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Dependente</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Dependente</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">2</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iLen</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// No. de Dependente-Tipo
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">cTipo</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cSexo</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cInvalido</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr
</span><span class="pas1-space">      </span><span class="pas1-reservedword">else
</span><span class="pas1-space">        </span><span class="pas1-identifier">cSexo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">cInvalido</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kRetiraChar</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'FMI'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">cTipo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">];

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Dependente</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cTipo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cSexo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cInvalido</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ========== Dados do Evento ========== }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'MN'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Minimo
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorMinimoEvento</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'MT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Multiplicador de Hora
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'MX'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Maximo
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorMaximoEvento</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ========== Funcoes para manipulacao de indices ========== }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'IL'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'IL'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceLocal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'IG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'IG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGlobal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'II'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">   </span><span class="pas1-comment">// Indice Local ou Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'II'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Local ou Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGeral</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Indice Local ou Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IndiceGeral</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ==========  Funcoes para manipulacao de tabelas ========== }

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * TL[t]([v]) ou TL([t],[v])
    Retorna o valor resultante da aplicação de taxa, redução e/ou acréscimo sobre
    o valor-alvo [v] conforme a faixa apropriada pesquisada da tabela local [t]. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TL'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TL'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número da tabela local
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * TLI[t]([i]) ou TLI([t],[i])
    Retorna o valor do item [i] da tabela global [t]. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TLI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor do Item da Tabela Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TLI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor do Item da Tabela Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">4</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número da tabela local
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaLocalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * TGI[t]([i]) ou TGI([t],[i])
    Retorna o valor do item [i] da tabela global [t]. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TGI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">    </span><span class="pas1-comment">// Valor do Item da Tabela Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TGI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor do Item da Tabela Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">4</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número da tabela global
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobalItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * TG[t]([v]) ou TG([t],[v]) - Tabela Global.
    Retorna o valor resultante da aplicação de taxa, redução e/ou acréscimo sobre
    o valor-alvo [v] conforme a faixa apropriada pesquisada na tabela global [t]. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número da tabela global
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * TBI[t]([i]) ou TBI([t],[i])
    Retorna o valor do item [i] da tabela local [t].
    Se a tabela local [t] não existir o item [t] será pesquisado
    na tabela global [t]. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TBI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor do Item da Tabela Geral
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGeralItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TBI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor do Item da Tabela Geral
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">4</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número da tabela Geral
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGeralItem</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * TB[t]([v]) ou TB([t],[v])
    Retorna o valor resultante da aplicação de taxa, redução e/ou acréscimo
    sobre o valor-alvo [v] conforme a faixa apropriada pesquisada na tabela [t].
    A tabela [t] será primeiramente pesquisada na empresa local, se a tabela
    não existir na empresa local será pesquisada na empresa global. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TB'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Geral
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TB'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Tabela Geral
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número da tabela Geral
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TabelaGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ========== Base de Acumulação ========== }

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * B&lt;n&gt; ou BB(&lt;n&gt;): Executa a base de acumulação &lt;n&gt;. Se a base
      não existir será gerado um erro &quot;Base de Acumulação não existe&quot;. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'B'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// Número da base de acumulação

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">BaseAcumulacao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvGE</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,
</span><span class="pas1-space">                             </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                             </span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'BB'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">];</span><span class="pas1-space">  </span><span class="pas1-comment">// Número da base de acumulação

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">BaseAcumulacao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvGE</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,
</span><span class="pas1-space">                             </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                             </span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">// Totalizadores/Acumuladores
</span><span class="pas1-space">  </span><span class="pas1-comment">// ==========================

</span><span class="pas1-space">  </span><span class="pas1-comment">// Totalizadores - TA

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TA'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">   </span><span class="pas1-comment">{ * TA, TA() ou TA( [A,M,Q,X,N,U], [C,I,R,T], [&lt;evento&gt;] )
     Executa uma totalização padrão.
     Será considerado apenas o evento em cálculo ou aquele que for informado em
     &lt;evento&gt;, as folhas cujo tipo seja igual ao tipo da folha em cálculo.
     Haverá uma operação de ACUMULAÇÃO sobre o valor CALCULADO.
     A operação poderá ser alterada pelo modificador [A,M,Q,X,N,U] e o
     valor pelo modificador [C,I,R,T] }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">for</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsOrdinal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">]
</span><span class="pas1-space">      </span><span class="pas1-reservedword">else
</span><span class="pas1-space">        </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">]);

</span><span class="pas1-space">    </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TA'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-comment">{ * TA[A,M,Q,X,N,U][C,I,R,T]
      Executa uma totalização padrão.
      Será considerado apenas o evento em cálculo e as folhas cujos tipos
      sejão igual ao tipo da folha em cálculo.
      A operação de totalização dependerá dos modificadores [A,M,Q,X,N] e o
      campo de cálculo dependerá  dos modificadores [C,I,R,T].
      Os modificadores não são obrigatórios e as respectivas ordens não são importantes. }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">or</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Length</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">4</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Totalizadores - TT }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">sValor</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-comment">{ * TT ou TT()
        Executa uma totalização padrão.
        Será considerado apenas o evento em cálculo,
        as folhas cujo tipo esteja com o campo &quot;Totalizar&quot; ativado.
        Haverá uma ACUMULAÇÃO do do valor CALCULADO do histórico de pagamentos.}

</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                  </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                  </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsOrdinal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-comment">{ * TT([n])
        Executa o totalizador [n].
        Se o totalizador não existir será gerado um erro
        &quot;Totalizador não existe&quot;. A operação e o valor de totalização serão o
        que está informado no totalizador. Somente as folhas que pertencerem
        aos tipos especificados no totalizador serão consideradas. Se nenhum
        tipo for estiver definido, somente os tipos cujo campo &quot;Totalizar&quot;
        estiver marcado. Somentes os eventos especificados no totalizador
        serão considerados. Se nenhum eventos estiver definido, será
        considerado apenas o evento em cálculo.}

</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Totalizador</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                            </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-comment">{ * TT( [A,M,Q,X,N,U] , [C,I,R,T] , [Z], [&lt;evento&gt;] )

        Executa uma totalização padrão.

        Será considerado apenas o evento em cálculo ou aquele informado em
        &lt;evento&gt; e as folhas cujos tipos estejam com o campo &quot;Totalizar&quot; ativado.

        Se for utilizado o modificador [Z] a verificação do campo &quot;Totalizar&quot;
        será desativada.

        A operação de totalização dependerá dos modificadores [A,M,Q,X,N,U] e o
        campo de cálculo dependerá dos modificadores [C,I,R,T].

        Os modificadores não são obrigatórios e as suas respectivas ordens
        também não são importantes. }

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">4</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">sTexto</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">for</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsOrdinal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">]
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'Z'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else
</span><span class="pas1-space">          </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">]);

</span><span class="pas1-space">      </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                  </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                  </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-comment">{ TT[A,M,Q,X,N,U][C,I,R,T][Z]

      Executa uma totalização padrão.

      Será considerado apenas o evento em cálculo e as folhas cujos
      tipos estejam com o campo &quot;Totalizar&quot; ativado.

      Se for utilizado o modificador [Z] a verificação do campo &quot;Totalizar&quot;
      será desativada.

      A operação de totalização dependerá dos modificadores [A,M,Q,X,N,U] e o
      campo de cálculo dependerá dos modificadores [C,I,R,T].

      Os modificadores não são obrigatórios e as suas
      respectivas ordens também não são importantes. }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">kNumerico</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// TT[1..99] mesmo que TT([n])

</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Totalizador</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">),
</span><span class="pas1-space">                            </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                            </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Pos</span><span class="pas1-symbol">(</span><span class="pas1-string">'Z'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">False</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">)+</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">+</span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                  </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                  </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bTotalizado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-comment">// Totalizadores - AA

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'AA'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">   </span><span class="pas1-comment">{ * AA ou AA()
     Executa uma totalização padrão.
     Será considerado apenas o evento em cálculo, as folhas cujo tipo
     seja igual ao tipo da folha em cálculo. Haverá uma acumulação do
     do valor CALCULADO do histórico de pagamentos do funcionário,
     o período considerado será o primeiro dia do ano até o ínicio do
     período da folha em cálculo. }

</span><span class="pas1-space">   </span><span class="pas1-comment">{ * AA( [A,M,Q,X,N,U] , [C,I,R,T] )
     Executa a mesma totalização de AA.
     A totalização dependerá dos modificadores [A,M,Q,X,N] e o
     campo de cálculo dependerá dos modificadores [C,I,R,T].
     Os modificadores não são obrigatórios e as suas respectivas ordens
     também não são importantes. }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">for</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsOrdinal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">]
</span><span class="pas1-space">      </span><span class="pas1-reservedword">else
</span><span class="pas1-space">        </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">UpperCase</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-identifier">i</span><span class="pas1-symbol">]);</span><span class="pas1-space"> 
    
    </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">FirstDayOfYear</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">),
</span><span class="pas1-space">                                </span><span class="pas1-identifier">AddDays</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'AA'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-comment">{ * AA[A,M,Q,X,N,U][C,I,R,T]
      Executa a mesma totalização de AA.
      A totalização dependerá dos modificadores [A,M,Q,X,N] e o
      campo de cálculo dependerá dos modificadores [C,I,R,T].
      Os modificadores não são obrigatórios e as suas respectivas ordens
      também não são importantes. }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">fCalculoValor</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                </span><span class="pas1-identifier">FirstDayOfYear</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">),
</span><span class="pas1-space">                                </span><span class="pas1-identifier">AddDays</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Ler os valores CALCULADO, INFORMADO, REFERENCIA E TOTALIZADO }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VC'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor calculado do evento
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VC'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sTexto</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">IsDigit</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'Argumento inválido para Função a VC(). Informe um número.'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">sTexto</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">   </span><span class="pas1-comment">// Valor Informado
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">     </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInformado
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-string">'INFORMADO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VR'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">   </span><span class="pas1-comment">// Valor Referencia
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvReferencia
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'REFERENCIA'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-string">'REFERENCIA'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">   </span><span class="pas1-comment">// Valor Totalizado
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'TOTALIZADO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-string">'TOTALIZADO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Funcoes para manipulacao de valores fixos }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VL'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">VarToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VL'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Local
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número do valor local
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorLocal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">VarToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VG'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número do valor global
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGlobal</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VV'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Local ou Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">VarToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'VV'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Local ou Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número do valor local ou global
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'V'</span><span class="pas1-symbol">)</span><span class="pas1-space">  </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Local ou Global
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));</span><span class="pas1-space">  </span><span class="pas1-comment">// número do valor local ou global
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ValorGeral</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Define os valores INFORMADO, REFERENCIA E TOTALIZADO }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'SETINF'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Atualiza valor informado
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">SetInformado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'SETREF'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">//  Atualiza valor referencia
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">SetReferencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'SETTOT'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">//  Atualiza valor referencia
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">SetTotalizado</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ ========== Outras funcoes de apoio ========== }

</span><span class="pas1-space">  </span><span class="pas1-comment">{ * CP[e] ou CP([e]) - Contra-Partida.
      Retorna o total de valores calculados para o evento [e] nas
      folhas de contra-partida especificadas na folha atual para funcionario. }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CP'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Contra partida
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">VarIsStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">VarToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'CP'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">ContraPartida</span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Valores recolhidos ou acumulados durante o calculo }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TX'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor da ultima taxa aplicada na formula
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvTaxa

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TB'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Total de Eventos - Base
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvBase

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TD'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Valor Total de Eventos - Desconto
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDesconto

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TP'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Valor Total de Eventos - Provento
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvProvento

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Total de Incidencia }

</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidenciaNome</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvEventoNome</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">]))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);


</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iLen</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'T'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-identifier">kNumerico</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">)));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'TI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalIncidencia</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'XE'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">2</span><span class="pas1-symbol">])

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'XE'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">));

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'XI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'NOME'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEventoNome</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'Não existe a incidência &quot;'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">pvEventoNome</span><span class="pas1-symbol">+</span><span class="pas1-string">'&quot;'</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">i</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencias</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">))

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">Args</span><span class="pas1-symbol">[</span><span class="pas1-number">2</span><span class="pas1-symbol">])

</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'XI'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">{ 06/06/2005 - allan_lima }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">StrToInt</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Copy</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iLen</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Month</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">),</span><span class="pas1-space"> </span><span class="pas1-identifier">Year</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">));

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Quantidade de dias utéis no periodo da folha }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'PDU'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasUteis</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Quantidade de domingos e feriados no periodo da folha }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'PDF'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasNaoUteis</span><span class="pas1-symbol">()

</span><span class="pas1-space">  </span><span class="pas1-comment">{ Gratificacao Natalina - 13o salario }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Eval</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'GN'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">ArgCount</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_ERRO_PARAMETRO</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Value</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">GN</span><span class="pas1-symbol">();

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// LocalEvaluate

{ Adicionado em 06/06/2005 por allan_lima }

{ XI - Retorna o total calculado para os eventos cuja incidencia esteja
       ativada das folhas de pagamento de mes de credito igual a
       &lt;Mes&gt; e &lt;Ano&gt; anteriores ao credito da folha atual }

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">XI</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Mes</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Ano</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">nil</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  SUM(C.CALCULADO*C.LIQUIDO)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_FOLHA F, F_CENTRAL C'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-comment">// Folha
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND EXTRACT(MONTH FROM F.DATA_CREDITO) = :MES'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND EXTRACT(YEAR FROM F.DATA_CREDITO)  = :ANO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.DATA_CREDITO &lt; :CREDITO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-comment">// Funcionario
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEMPRESA = F.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFOLHA   = F.IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-comment">// Evento
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEVENTO IN (SELECT IDEVENTO FROM F_EVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'                     WHERE INC_'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">kStrZero</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Incidencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">2</span><span class="pas1-symbol">)+</span><span class="pas1-string">'_X = 1)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Mes</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Ano</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">],
</span><span class="pas1-space">                     </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// XI

{ Adicionado em 06/06/2005 por allan_lima }

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">XE</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Mes</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Ano</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">nil</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  SUM(C.CALCULADO*C.LIQUIDO)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_FOLHA F, F_CENTRAL C'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-comment">// Folha
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND EXTRACT(MONTH FROM F.DATA_CREDITO) = :MES'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND EXTRACT(YEAR FROM F.DATA_CREDITO)  = :ANO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.DATA_CREDITO &lt; :CREDITO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-comment">// Funcionario
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEMPRESA = F.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFOLHA   = F.IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-comment">// Evento
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEVENTO = :EVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Mes</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Ano</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvCredito</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">],
</span><span class="pas1-space">                     </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// XE

{ Função: ValorBase
  Descrição: Retorna o total do evento processados nas folhas bases
             para desconto/abatimento ao evento da folha complementar }
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">ValorBase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 19/06/2005 - allan_lima }
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">nil</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  SUM(C.CALCULADO)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_FOLHA_BASE F, F_CENTRAL C'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA = :FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEMPRESA = F.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFOLHA = F.IDFOLHA_BASE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEVENTO = :EVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">],
</span><span class="pas1-space">                     </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// ValorBase

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">DiasUteis</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 08/03/2007 - allan_kardek }
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Trunc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">-</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">)+</span><span class="pas1-number">1</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Total de dias no periodo
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasNaoUteis</span><span class="pas1-symbol">();
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDiasUteis</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">DiasNaoUteis</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 08/03/2007 - allan_kardek }
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">iFeriado</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iSunday</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDiasNaoUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-identifier">cdFeriado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">try

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">,
</span><span class="pas1-space">                      </span><span class="pas1-string">'SELECT * FROM FERIADO WHERE DATA BETWEEN :D1 AND :D2'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                      </span><span class="pas1-symbol">[</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">iFeriado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Qtde de feriados não-domingos
</span><span class="pas1-space">      </span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">DayOfWeek</span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'DATA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsDateTime</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">Inc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">iFeriado</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">iSunday</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kWeekDayCount</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">);</span><span class="pas1-space">  </span><span class="pas1-comment">// Total de domingos

</span><span class="pas1-space">      </span><span class="pas1-identifier">pvDiasNaoUteis</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iFeriado</span><span class="pas1-symbol">+</span><span class="pas1-identifier">iSunday</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">      </span><span class="pas1-identifier">cdFeriado</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDiasNaoUteis</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">DSR</span><span class="pas1-symbol">():</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 23/08/2006 - allan_lima }
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvDSR</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-comment">// pvDSR := (iFeriado+iSunday) / iDay;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvDSR</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasNaoUteis</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">DiasUteis</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-comment">{ 27/02/2007 - Sergio Toshio Kawahara }
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">pvDSR</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-comment">{
- MAA - Meses de Admissao no Ano

  É o número de meses entre janeiro e dezembro do ano da folha que o
  funcionário trabalhará se não for demitido no ano.

  Se o funcionário foi admitido em anos anteriores MAA sempre será 12 (doze).
  Para os funcionários admitidos no ano da folha MAA será a diferênça entre 12
  e o mês de admissão desse funcionário. Se o funcionário trabalhou menos de
  15 (quinze) dias no mês de sua admissão esse mês não será considerado na contagem.
}
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">MAA</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 03/03/2007 - allan_kardek }
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">YearOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-identifier">YearOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">12.0
</span><span class="pas1-space">  </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">YearOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">YearOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">MonthOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmisSao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-float">1.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">DayOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">LastDayOfMonth</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">))</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">DayOf</span><span class="pas1-symbol">(</span><span class="pas1-identifier">pvAdmissao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-number">15</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-float">1.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// MAA

{
- MM - Meses para Média

  É o número de meses que será considerado para o cálculo de médias.
  Esse número é calculado do seguinte modo: ::

    MESES_NO_PERIODO - (12 - MAA)
}
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">MM</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">{ 03/03/2007 - allan_kardek }
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DiffMonths</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-number">12</span><span class="pas1-space">  </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">MAA</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// MM

{
- GN - Gratificação Natalina (13o. salário)
}
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TkCalculador</span><span class="pas1-symbol">.</span><span class="pas1-identifier">GN</span><span class="pas1-symbol">():</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">const
</span><span class="pas1-space">  </span><span class="pas1-comment">// Tipo de Salário
</span><span class="pas1-space">  </span><span class="pas1-identifier">TS_SALARIO_FIXO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TS_SALARIO_VARIAVEL</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'V'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TS_PRODUCAO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'P'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-comment">// Tipo de Cálculo
</span><span class="pas1-space">  </span><span class="pas1-identifier">TC_CONTRA_PARTIDA</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TC_VALOR_INFORMADO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TC_HORA_TRABALHADA</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'H'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TC_DIA_TRABALHADO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TC_FORMULA</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'F'</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sSalario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TAKExpression</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">):</span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvEmpresa</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                 </span><span class="pas1-identifier">pvFuncionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvInicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvFim</span><span class="pas1-symbol">,
</span><span class="pas1-space">                                 </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">True</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">cdEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">eFormula</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TAKExpression</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">eFormula</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">OnEvaluate</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">LocalEvaluate</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">OnVariable</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">LocalVariable</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">E</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdSequencia</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">F</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFuncionario</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">L</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSetList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">R</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdRescisao</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">{ Seleciona todos os eventos que incidem sobre o 13o. salário. }
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  E.*, F.FORMULA AS FORMULA_EVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_EVENTO E, F_FORMULA F'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  E.INC_13_X = 1 AND E.ATIVO_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFORMULA = E.IDFORMULA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">pvSQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">pvStartTransaction</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">MAA</span><span class="pas1-symbol">();</span><span class="pas1-space">  </span><span class="pas1-comment">{ Meses de Admissao no Ano }
</span><span class="pas1-space">    </span><span class="pas1-identifier">cMM</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">MM</span><span class="pas1-symbol">();</span><span class="pas1-space">    </span><span class="pas1-comment">{ Meses para Média }

</span><span class="pas1-space">    </span><span class="pas1-comment">{ Os eventos encontrados são colocados em uma lista que será percorrida item a item }
</span><span class="pas1-space">    </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-identifier">iEvento</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TIPO_SALARIO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'TIPO_CALCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FORMULA_EVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'FORMULA_LOCAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-comment">{ SALARIO FIXO }

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_FIXO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_CONTRA_PARTIDA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ VALOR_CALCULADO_NO_ULTIMO_MES / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">);

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_FIXO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_VALOR_INFORMADO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ VALOR_CALCULADO_NO_ULTIMO_MES / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">);

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_FIXO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_HORA_TRABALHADA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( VALOR_INFORMADO_NO_ULTIMO_MES * HT * MT ) / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_FIXO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_DIA_TRABALHADO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( VALOR_INFORMADO_NO_ULTIMO_MES * DT * MT ) / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-symbol">()/</span><span class="pas1-number">30</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_FIXO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_FORMULA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 1. Considera o VALOR_INFORMADO_NO_ULTIMO_MES como VALOR_INFORMADO (VI); }
</span><span class="pas1-space">          </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">);

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaEvento
</span><span class="pas1-space">          </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'É obrigatório que o evento possua fórmula.'</span><span class="pas1-symbol">);

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 2. Processa a fórmula do evento; }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AsDouble</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 3. RESULTADO_DA_FORMULA / 12 * MAA. }
</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA

</span><span class="pas1-space">        </span><span class="pas1-comment">{ SALARIO VARIAVEL }

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_VARIAVEL</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_CONTRA_PARTIDA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( TOTAL_VALOR_CALCULADO_NO_PERIODO / MM ) / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_VARIAVEL</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_VALOR_INFORMADO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( TOTAL_VALOR_CALCULADO_NO_PERIODO / MM ) / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_VARIAVEL</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_HORA_TRABALHADA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ (( TOTAL_VALOR_INFORMADO_NO_PERIODO / MM) / 12 * MAA ) * HT * MT }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_VARIAVEL</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_DIA_TRABALHADO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ (( TOTAL_VALOR_INFORMADO_NO_PERIODO / MM) / 12 * MAA ) * DT * MT }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-symbol">()/</span><span class="pas1-float">30.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_SALARIO_VARIAVEL</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_FORMULA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 1. Considera como VALOR INFORMADO (VI) a expressão:
               (TOTAL_VALOR_INFORMADO_NO_PERIODO / MM ) / 12 * MAA; }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 2. Processa a fórmula do evento; }
</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaEvento
</span><span class="pas1-space">          </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'É obrigatório que o evento possua fórmula.'</span><span class="pas1-symbol">);

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 3. Assume o retorno da fórmula com resultado do cálculo. }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AsDouble</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-comment">{ PRODUÇÃO / PEÇA / TAREFA }

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_PRODUCAO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_CONTRA_PARTIDA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( TOTAL_VALOR_CALCULADO_NO_PERIODO / MM ) / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_PRODUCAO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_VALOR_INFORMADO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( TOTAL_VALOR_CALCULADO_NO_PERIODO / MM ) / 12 * MAA }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'C'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_PRODUCAO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_HORA_TRABALHADA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( ( TOTAL_VALOR_INFORMADO_NO_PERIODO / MM ) / 12 * MAA ) * HT * MT }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">HoraNormal</span><span class="pas1-symbol">()</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_PRODUCAO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_DIA_TRABALHADO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ ( ( TOTAL_VALOR_INFORMADO_NO_PERIODO / MM ) / 12 * MAA ) * DT * MT }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">SalarioMensal</span><span class="pas1-symbol">()/</span><span class="pas1-float">30.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">pvMultiplicador</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSalario</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TS_PRODUCAO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">TC_FORMULA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 1. Considera como VALOR INFORMADO (VI) a expressão:
              (TOTAL_VALOR_INFORMADO_NO_PERIODO / MM ) / 12 * MAA; }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TTT</span><span class="pas1-symbol">(</span><span class="pas1-string">'I'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-identifier">cMM</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cMAA</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">/</span><span class="pas1-space"> </span><span class="pas1-float">12.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">*</span><span class="pas1-space"> </span><span class="pas1-identifier">cMAA</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-identifier">pvInformado</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 2. Processa a fórmula do evento; }
</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaEvento
</span><span class="pas1-space">          </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">sFormulaLocal</span><span class="pas1-symbol">;

</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'É obrigatório que o evento possua fórmula.'</span><span class="pas1-symbol">);

</span><span class="pas1-space">          </span><span class="pas1-comment">{ 3. Assume o retorno da fórmula com resultado do cálculo. }
</span><span class="pas1-space">          </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AsDouble</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-comment">{ O valor calculado ser acumulado internamente}
</span><span class="pas1-space">        </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-comment">{ e o processamento seguirá para o próximo item (evento) da lista.}
</span><span class="pas1-space">        </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// not Eof

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// with cdEvento

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">eFormula</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// function GN() - Gratificação Natalina (13o. salário)

{ Totalizador: 12/04/2004}

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">TotalizadorPadrao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">TipoFolha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">String</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Totalizado</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'SUM'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'SUM'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'Q'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'COUNT'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'AVG'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'X'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'MAX'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'N'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'MIN'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-space"> </span><span class="pas1-comment">// Ultima competencia
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'O parametro &quot;calculo&quot; deve ser [Q,M,X,N,U]'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'INFORMADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'T'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'TOTALIZADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'REFERENCIA'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'O parametro &quot;valor&quot; deve ser [C,I,T,R]'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)
</span><span class="pas1-space">      </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'F.COMPETENCIA, SUM(C.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">+</span><span class="pas1-string">')'</span><span class="pas1-symbol">)
</span><span class="pas1-space">      </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">Calculo</span><span class="pas1-symbol">+</span><span class="pas1-string">'(C.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">+</span><span class="pas1-string">')'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_CENTRAL C, F_FOLHA F'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">TipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-identifier">Totalizado</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">', F_FOLHA_TIPO T'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  C.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEVENTO = :EVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDEMPRESA = C.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA = C.IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.PERIODO_INICIO &gt;= :INICIO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.PERIODO_FIM &lt;= :FIM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.ARQUIVAR_X = 1'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">TipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;&gt;</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA_TIPO = :TIPO'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">Totalizado</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND T.IDFOLHA_TIPO = F.IDFOLHA_TIPO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND T.TOTALIZAR_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'GROUP BY 1'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">TipoFolha</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">kGetErrorLastSQL</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Calculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Last</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Fields</span><span class="pas1-symbol">[</span><span class="pas1-number">0</span><span class="pas1-symbol">].</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// TotalizadorPadrao

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">Totalizador</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Total</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">iTipoFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iIncidencia</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Currency</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">bIT</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL1</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL2</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-identifier">DataSet1</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTotal</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdEvento</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'(IDTOTAL = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Total</span><span class="pas1-symbol">)+</span><span class="pas1-string">')'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_TOTALIZADOR'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[],</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">kGetErrorLastSQL</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RecordCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">CreateFmt</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'Totalizador &quot;%d&quot; não existe.'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Total</span><span class="pas1-symbol">]);

</span><span class="pas1-space">    </span><span class="pas1-identifier">iEvento</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F_TOTALIZADOR_EVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">iTipoFolha</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F_TOTALIZADOR_FOLHA'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                              </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">+</span><span class="pas1-string">' AND (ATIVO_X = 1)'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">iIncidencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'F_TOTALIZADOR_INCIDENCIA'</span><span class="pas1-symbol">,
</span><span class="pas1-space">                              </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">+</span><span class="pas1-string">' AND (ATIVO_X = 1)'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iIncidencia</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Evento</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'Erro no totalizador no. '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Total</span><span class="pas1-symbol">)+</span><span class="pas1-identifier">sLineBreak</span><span class="pas1-symbol">+
</span><span class="pas1-space">                               </span><span class="pas1-string">'Não é possível realizar o cálculo.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sLineBreak</span><span class="pas1-symbol">+
</span><span class="pas1-space">                               </span><span class="pas1-string">'Faltar informar eventos ou incidências.'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">Evento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space">  </span><span class="pas1-number">0</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Não considera o evento informado

</span><span class="pas1-space">    </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CALCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">sValor</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space">      </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'SUM'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'AVG'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'N'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'MIN'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'Q'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'COUNT'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'X'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'MAX'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'U'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'O campo &quot;calculo&quot; deve ser [A,Q,M,N,X,U]'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space">      </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'INFORMADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'T'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'TOTALIZADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'REFERENCIA'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'O campo &quot;valor&quot; deve ser [C,I,T,R]'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'F.COMPETENCIA, SUM(C.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">+</span><span class="pas1-string">') AS VALOR'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">+</span><span class="pas1-string">'(C.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">+</span><span class="pas1-string">') AS VALOR'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_CENTRAL C, F_FOLHA F'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  C.IDEMPRESA = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFUNCIONARIO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">));
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.IDEMPRESA = C.IDEMPRESA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.IDFOLHA = C.IDFOLHA)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.PERIODO_INICIO &gt;= :INICIO AND F.PERIODO_FIM &lt;= :FIM)'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.ARQUIVAR_X = 1)'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iTipoFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.IDFOLHA_TIPO IN ('</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'        SELECT IDFOLHA_TIPO FROM F_FOLHA_TIPO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'        WHERE (TOTALIZAR_X = 1)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      ))'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.IDFOLHA_TIPO IN ('</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'        SELECT IDFOLHA_TIPO FROM F_TOTALIZADOR_FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'        WHERE IDTOTAL = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Total</span><span class="pas1-symbol">)+</span><span class="pas1-string">' AND ATIVO_X = 1'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      ))'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'GROUP BY 1'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Evento</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space">  </span><span class="pas1-comment">// Considera apenas este evento (que foi informado)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddStrings</span><span class="pas1-symbol">(</span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (C.IDEVENTO = :EVENTO)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddStrings</span><span class="pas1-symbol">(</span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Last</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Evento &gt; 0

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenTable</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_TOTALIZADOR_EVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddStrings</span><span class="pas1-symbol">(</span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (C.IDEVENTO = :EVENTO)'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddStrings</span><span class="pas1-symbol">(</span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-identifier">iEvento</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDEVENTO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                         </span><span class="pas1-symbol">[</span><span class="pas1-identifier">iEvento</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Last</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">case</span><span class="pas1-space"> </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'OPERACAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-reservedword">of
</span><span class="pas1-space">          </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;
</span><span class="pas1-space">           </span><span class="pas1-number">1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// cdEvento.Eof

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// iEvento &gt; 0

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iIncidencia</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'(IDTOTAL = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Total</span><span class="pas1-symbol">)+</span><span class="pas1-string">') AND (ATIVO_X = 1) AND '</span><span class="pas1-symbol">+
</span><span class="pas1-space">                </span><span class="pas1-string">'( (PROVENTOS_X = 1) OR (DESCONTOS_X = 1) )'</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenTable</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">,
</span><span class="pas1-space">                         </span><span class="pas1-string">'F_TOTALIZADOR_INCIDENCIA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">      </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'DESCONTOS_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and
</span><span class="pas1-space">           </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'PROVENTOS_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'TIPO_EVENTO IN ('</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-string">'D'</span><span class="pas1-symbol">)+</span><span class="pas1-string">','</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-string">'P'</span><span class="pas1-symbol">)+</span><span class="pas1-string">')'
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'PROVENTOS_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'TIPO_EVENTO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-string">'P'</span><span class="pas1-symbol">)
</span><span class="pas1-space">        </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'DESCONTOS_X'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'TIPO_EVENTO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">QuotedStr</span><span class="pas1-symbol">(</span><span class="pas1-string">'D'</span><span class="pas1-symbol">);

</span><span class="pas1-space">        </span><span class="pas1-identifier">iIncidencia</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'IDINCIDENCIA'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'('</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">+</span><span class="pas1-string">') AND (INC_'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">kStrZero</span><span class="pas1-symbol">(</span><span class="pas1-identifier">iIncidencia</span><span class="pas1-symbol">,</span><span class="pas1-number">2</span><span class="pas1-symbol">)+</span><span class="pas1-string">'_X = 1)'</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddStrings</span><span class="pas1-symbol">(</span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEVENTO IN'</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      (SELECT IDEVENTO FROM F_EVENTO WHERE '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">+</span><span class="pas1-string">')'</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">AddStrings</span><span class="pas1-symbol">(</span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">);
</span><span class="pas1-space">        </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">,</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">bIT</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Last</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">cValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">case</span><span class="pas1-space"> </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'OPERACAO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-reservedword">of
</span><span class="pas1-space">          </span><span class="pas1-symbol">-</span><span class="pas1-number">1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;
</span><span class="pas1-space">           </span><span class="pas1-number">1</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">cValor</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// cdIncidencia.Eof

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// iIncidencia &gt; 0

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdEvento</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdIncidencia</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">DataSet1</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Totalizador


{ Base de Acumulacao: 01/06/2004}

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> </span><span class="pas1-identifier">BaseAcumulacao</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">GE</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Base</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDateTime</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-space"> </span><span class="pas1-symbol">):</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">const
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_DESCONSIDERAR</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'D'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_CONSIDERAR</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_ACUMULADO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'A'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_CONTAGEM</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'Q'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_MEDIA</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'M'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_MAXIMO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'X'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">C_MINIMO</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'N'</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var
</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">sCalculo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sRegime</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sCompetencia13</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sSemValor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">bTotalizar</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">bEvento</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">i</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iCiclo</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iMesInicial</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iAno</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iMes</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Integer</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> </span><span class="pas1-identifier">CalculoBase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">TDataSet</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-identifier">Double</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_CONTAGEM</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-number">1
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_MINIMO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.00</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">          </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Min</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_MAXIMO</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Max</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-comment">// Acumulado ou Media
</span><span class="pas1-space">      </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">Valor</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-identifier">DataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">begin

</span><span class="pas1-space">  </span><span class="pas1-identifier">SQL</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TStringList</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdBase</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdTotal</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-identifier">cdFolha</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">TClientDataSet</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">NIL</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-identifier">Result</span><span class="pas1-space">  </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;

</span><span class="pas1-space">  </span><span class="pas1-reservedword">try

</span><span class="pas1-space">    </span><span class="pas1-identifier">sWhere</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'IDGE = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">GE</span><span class="pas1-symbol">)+</span><span class="pas1-string">' AND IDBASE = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Base</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">Inicio</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FirstDayOfMonth</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-string">'F_BASE'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Active</span><span class="pas1-space"> </span><span class="pas1-reservedword">or</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">RecordCount</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-string">'Base de Acumulação No. '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Base</span><span class="pas1-symbol">)+</span><span class="pas1-string">' não existe.'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">bTotalizar</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-string">'F_BASE_FOLHA'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">bEvento</span><span class="pas1-space">    </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">kCountSQL</span><span class="pas1-symbol">(</span><span class="pas1-string">'F_BASE_EVENTO'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">sCalculo</span><span class="pas1-space">   </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CALCULO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">sValor</span><span class="pas1-space">     </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">{ CICLO: Quantidade de meses de acumulação da base.
      Se você informar 0 (zero), o ciclo de meses será indefinido.
      Se você informar 1 (um), o ciclo de um mês.
      Se você informar 2 (dois), o ciclo será de 2 meses. E assim por diante. }

</span><span class="pas1-space">    </span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'CICLO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">{ REGIME: Quando o ciclo for de 1 (um) mês, pode-se escolher entre os
      regimes de competência ou de caixa, ou seja, pelo mês de competência da
      folha ou pelo mês de crédito da folha de pagamento. Para
      ciclos maiores que 1 (um) mês, o regime sempre será por competência. }

</span><span class="pas1-space">    </span><span class="pas1-identifier">sRegime</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'REGIME'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-comment">// Competência ou Caixa

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">sRegime</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// Competencia

</span><span class="pas1-space">    </span><span class="pas1-comment">{ MÊS INICIAL: Para ciclos igual ou maior que 12 (doze) meses, a base
      necessita do  mês de partida. O mês inicial indica o mês a partir da qual
      a base será mantida atualizada. }

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-number">12</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">iMesInicial</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">iMesInicial</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'MES_INICIAL'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">{ COMPETÊNCIA 13: Informa ao sistema como tratar os valores das folhas de
      competência 13. Os valores possiveis para este campo são:

      * Desconsiderar - Não pesquisa os valores da competência 13;
      * Integrar - Pesquisa os valores da competência 13, somando-os à competência 12. }

</span><span class="pas1-space">    </span><span class="pas1-identifier">sCompetencia13</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'COMPETENCIA_13'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">{ MESES SEM VALOR: Diz ao sistema como proceder quando não existirem
      valores para determinados meses no histórico pesquisado. Esta
      informação é importante porque influencia o ciclo e o resultado da base,
      principalmete quando o &quot;Cálculo&quot; for uma &quot;Média&quot; ou &quot;Contagem&quot;.

      Os valores possíveis são &quot;Considerar&quot; ou &quot;Desconsiderar&quot;. }

</span><span class="pas1-space">    </span><span class="pas1-identifier">sSemValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'MES_SEM_VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsString</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">// Inicia o processamento da base

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">)</span><span class="pas1-space">          </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'I'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'INFORMADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'T'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'TOTALIZADO'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">[</span><span class="pas1-number">1</span><span class="pas1-symbol">]</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'R'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'REFERENCIA'
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-identifier">sValor</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'CALCULADO'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sRegime</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Regime - Competencia
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  EXTRACT( YEAR FROM F.PERIODO_FIM) AS ANO, F.MES,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin</span><span class="pas1-space">                   </span><span class="pas1-comment">// Regime - Caixa
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  EXTRACT( YEAR FROM F.DATA_CREDITO) AS ANO,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  EXTRACT( MONTH FROM F.DATA_CREDITO) AS MES,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">bEvento</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  SUM(C.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">+</span><span class="pas1-string">') AS VALOR'</span><span class="pas1-symbol">)
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  SUM(C.'</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sValor</span><span class="pas1-symbol">+</span><span class="pas1-string">'*E.REFERENCIA) AS VALOR'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bEvento</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_BASE_EVENTO E,'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_CENTRAL C, F_FOLHA F'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">bEvento</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  C.IDEVENTO = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Evento</span><span class="pas1-symbol">))
</span><span class="pas1-space">    </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">' E.IDGE = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">GE</span><span class="pas1-symbol">));
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">' AND E.IDBASE = '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">IntToStr</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Base</span><span class="pas1-symbol">));
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">' AND C.IDEVENTO = E.IDEVENTO'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND C.IDFUNCIONARIO = :FUNCIONARIO'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDEMPRESA = C.IDEMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA = C.IDFOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.PERIODO_INICIO &gt;= :INICIO AND'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'       F.PERIODO_FIM &lt;= :FIM)'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCompetencia13</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_DESCONSIDERAR</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.COMPETENCIA &lt; 13'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bTotalizar</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA_TIPO IN'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      (SELECT IDFOLHA_TIPO FROM F_BASE_FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'       WHERE '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">+</span><span class="pas1-string">')'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'GROUP BY 1, 2'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Funcionario</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-comment">// Lista de Folhas de Pagamentos

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">BeginUpdate</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Clear</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'SELECT'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sRegime</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-string">'C'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">// Regime - Competencia
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  EXTRACT(YEAR FROM F.PERIODO_FIM) AS ANO, F.MES,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin</span><span class="pas1-space">                   </span><span class="pas1-comment">// Regime - Caixa
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  EXTRACT(YEAR FROM F.DATA_CREDITO) AS ANO,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  EXTRACT(MONTH FROM F.DATA_CREDITO) AS MES,'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">' 0.0 AS VALOR'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'FROM'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F_FOLHA F'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'WHERE'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  F.IDEMPRESA = :EMPRESA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA &lt;&gt; :FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND (F.PERIODO_INICIO &gt;= :INICIO AND'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'       F.PERIODO_FIM &lt;= :FIM)'</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">bTotalizar</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'  AND F.IDFOLHA_TIPO IN'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'      (SELECT IDFOLHA_TIPO FROM F_BASE_FOLHA'</span><span class="pas1-symbol">);
</span><span class="pas1-space">      </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Add</span><span class="pas1-symbol">(</span><span class="pas1-string">'       WHERE '</span><span class="pas1-symbol">+</span><span class="pas1-identifier">sWhere</span><span class="pas1-symbol">+</span><span class="pas1-string">')'</span><span class="pas1-symbol">);
</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">EndUpdate</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">kOpenSQL</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Text</span><span class="pas1-symbol">,
</span><span class="pas1-space">                     </span><span class="pas1-symbol">[</span><span class="pas1-identifier">Empresa</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Folha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Inicio</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Fim</span><span class="pas1-symbol">],</span><span class="pas1-space"> </span><span class="pas1-identifier">IniciarTransacao</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">raise</span><span class="pas1-space"> </span><span class="pas1-identifier">Exception</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Create</span><span class="pas1-symbol">(</span><span class="pas1-identifier">EmptyStr</span><span class="pas1-symbol">);

</span><span class="pas1-space">    </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">IndexFieldNames</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'ANO;MES'</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">// -----------------------------------------

</span><span class="pas1-space">    </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdTotal</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-identifier">IndexFieldNames</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'ANO;MES'</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-identifier">iMes</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'MES'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-identifier">iAno</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'ANO'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Locate</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-string">'ANO;MES'</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">VarArrayOf</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-symbol">[</span><span class="pas1-identifier">iAno</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">iMes</span><span class="pas1-symbol">]),</span><span class="pas1-space"> </span><span class="pas1-symbol">[])</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Edit</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Post</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-comment">// Calcular o valor da base propriamente dita

</span><span class="pas1-space">    </span><span class="pas1-reservedword">with</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">    </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sSemValor</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_DESCONSIDERAR</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-comment">{ Retirar os meses sem valor }
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">        </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'VALOR'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsCurrency</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">Delete
</span><span class="pas1-space">          </span><span class="pas1-reservedword">else
</span><span class="pas1-space">            </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0</span><span class="pas1-symbol">;
</span><span class="pas1-space">      </span><span class="pas1-identifier">i</span><span class="pas1-space">      </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-comment">{ Ciclo indefinido - Considera todos os meses pesquisados }

</span><span class="pas1-space">        </span><span class="pas1-identifier">First</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Eof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-identifier">CalculoBase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-identifier">Next</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">&lt;</span><span class="pas1-space"> </span><span class="pas1-number">12</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-comment">{ Se o &quot;ciclo&quot; é menor que 12 (doze) o &quot;mês inicial&quot; é 0 (zero),
          então considera os últimos &quot;nn&quot; meses }

</span><span class="pas1-space">        </span><span class="pas1-identifier">Last</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Bof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">&gt;</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-identifier">CalculoBase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-identifier">iCiclo</span><span class="pas1-space"> </span><span class="pas1-symbol">-</span><span class="pas1-space"> </span><span class="pas1-number">1</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">Prior</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-space"> </span><span class="pas1-reservedword">else</span><span class="pas1-space">  </span><span class="pas1-comment">{ iCiclo &gt;= 12 }
</span><span class="pas1-space">      </span><span class="pas1-reservedword">begin

</span><span class="pas1-space">        </span><span class="pas1-comment">{ Se o &quot;ciclo&quot; é maior ou igual a 12 (doze), considera o &quot;mes inicial&quot; }

</span><span class="pas1-space">        </span><span class="pas1-identifier">Last</span><span class="pas1-symbol">;

</span><span class="pas1-space">        </span><span class="pas1-reservedword">while</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-reservedword">not</span><span class="pas1-space"> </span><span class="pas1-identifier">Bof</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">do
</span><span class="pas1-space">        </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">          </span><span class="pas1-identifier">CalculoBase</span><span class="pas1-symbol">(</span><span class="pas1-space"> </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-symbol">);
</span><span class="pas1-space">          </span><span class="pas1-comment">{ Chegou-se ao mes inicial encerra a pesquisa }
</span><span class="pas1-space">          </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">FieldByName</span><span class="pas1-symbol">(</span><span class="pas1-string">'MES'</span><span class="pas1-symbol">).</span><span class="pas1-identifier">AsInteger</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">iMesInicial</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">            </span><span class="pas1-identifier">Break</span><span class="pas1-symbol">;
</span><span class="pas1-space">          </span><span class="pas1-identifier">Prior</span><span class="pas1-symbol">;
</span><span class="pas1-space">        </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">      </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-space">    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// with cdFolha

</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">sCalculo</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-identifier">C_MEDIA</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">i</span><span class="pas1-space"> </span><span class="pas1-symbol">=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-float">0.0
</span><span class="pas1-space">                 </span><span class="pas1-reservedword">else</span><span class="pas1-space"> </span><span class="pas1-identifier">Result</span><span class="pas1-space"> </span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-symbol">(</span><span class="pas1-identifier">Result</span><span class="pas1-symbol">/</span><span class="pas1-identifier">i</span><span class="pas1-symbol">);

</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    </span><span class="pas1-identifier">SQL</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdBase</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdTotal</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-identifier">cdFolha</span><span class="pas1-symbol">.</span><span class="pas1-identifier">Free</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;</span><span class="pas1-space">  </span><span class="pas1-comment">// BaseAcumulacao

</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">.

</span></span>
</code></pre>
</body>
</html>